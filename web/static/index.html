<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Adapter - 接口管理系统</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- 侧边栏 -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-cube"></i> MCP Adapter</h2>
                <p class="version">v2.0</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-tab="applications">
                    <i class="fas fa-folder-open"></i>
                    <span>应用管理</span>
                </li>
                <li class="nav-item" data-tab="custom-types">
                    <i class="fas fa-shapes"></i>
                    <span>自定义类型</span>
                </li>
                <li class="nav-item" data-tab="interfaces">
                    <i class="fas fa-plug"></i>
                    <span>接口管理</span>
                </li>
                <li class="nav-item" data-tab="docs">
                    <i class="fas fa-book"></i>
                    <span>文档</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="current-app">
                    <label>当前应用:</label>
                    <select id="global-app-select">
                        <option value="">请选择应用</option>
                    </select>
                </div>
            </div>
        </nav>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 应用管理页面 -->
            <div class="tab-content active" id="applications-tab">
                <!-- 应用列表视图 -->
                <div id="app-list-view">
                    <div class="page-header">
                        <div>
                            <h1><i class="fas fa-folder-open"></i> 应用管理</h1>
                            <p>管理您的应用和服务</p>
                        </div>
                        <button class="btn btn-primary" id="create-app-btn">
                            <i class="fas fa-plus"></i> 创建应用
                        </button>
                    </div>

                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="搜索应用..." id="app-search">
                    </div>

                    <div class="cards-grid" id="applications-grid">
                        <!-- 应用卡片动态生成 -->
                    </div>
                </div>

                <!-- 应用编辑/创建视图 -->
                <div id="app-form-view" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1><i class="fas fa-folder-open"></i> <span id="app-form-title">创建应用</span></h1>
                            <p id="app-form-subtitle">填写应用信息</p>
                        </div>
                        <button class="btn btn-secondary" id="app-form-back">
                            <i class="fas fa-arrow-left"></i> 返回列表
                        </button>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label class="required">应用名称</label>
                            <input type="text" id="app-name" placeholder="例如: 我的API服务">
                        </div>
                        <div class="form-group">
                            <label>应用描述</label>
                            <textarea id="app-description" rows="3" placeholder="描述应用的功能"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="required">应用路径</label>
                            <input type="text" id="app-path" placeholder="例如: my-api">
                        </div>
                        <div class="form-group">
                            <label class="required">协议类型</label>
                            <select id="app-protocol">
                                <option value="sse">SSE</option>
                                <option value="streamable">Streamable</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" id="app-form-cancel">取消</button>
                            <button class="btn btn-primary" id="app-form-submit">保存</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 自定义类型管理页面 -->
            <div class="tab-content" id="custom-types-tab">
                <!-- 类型列表视图 -->
                <div id="type-list-view">
                    <div class="page-header">
                        <div>
                            <h1><i class="fas fa-shapes"></i> 自定义类型</h1>
                            <p>定义可复用的数据类型</p>
                        </div>
                        <button class="btn btn-primary" id="create-type-btn">
                            <i class="fas fa-plus"></i> 创建类型
                        </button>
                    </div>

                    <div class="alert alert-info" id="no-app-alert" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        请先在侧边栏选择一个应用
                    </div>

                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="搜索类型..." id="type-search">
                    </div>

                    <div class="cards-grid" id="types-grid">
                        <!-- 类型卡片动态生成 -->
                    </div>
                </div>

                <!-- 类型编辑/创建视图 -->
                <div id="type-form-view" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1><i class="fas fa-shapes"></i> <span id="type-form-title">创建类型</span></h1>
                            <p id="type-form-subtitle">定义数据类型和字段</p>
                        </div>
                        <button class="btn btn-secondary" id="type-form-back">
                            <i class="fas fa-arrow-left"></i> 返回列表
                        </button>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label class="required">类型名称</label>
                            <input type="text" id="type-name" placeholder="例如: User">
                        </div>
                        <div class="form-group">
                            <label>类型描述</label>
                            <textarea id="type-description" rows="2" placeholder="描述这个类型的用途"></textarea>
                        </div>
                        <div class="form-group">
                            <label>字段定义</label>
                            <div id="fields-container"></div>
                            <button type="button" class="btn btn-secondary mt-2" onclick="addFieldRow()">
                                <i class="fas fa-plus"></i> 添加字段
                            </button>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" id="type-form-cancel">取消</button>
                            <button class="btn btn-primary" id="type-form-submit">保存</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 接口管理页面 -->
            <div class="tab-content" id="interfaces-tab">
                <!-- 接口列表视图 -->
                <div id="interface-list-view">
                    <div class="page-header">
                        <div>
                            <h1><i class="fas fa-plug"></i> 接口管理</h1>
                            <p>管理 HTTP 接口和参数</p>
                        </div>
                        <button class="btn btn-primary" id="create-interface-btn">
                            <i class="fas fa-plus"></i> 创建接口
                        </button>
                    </div>

                    <div class="alert alert-info" id="no-app-alert-interface" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        请先在侧边栏选择一个应用
                    </div>

                    <div class="filters">
                        <div class="search-bar">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="搜索接口..." id="interface-search">
                        </div>
                        <select id="method-filter">
                            <option value="">所有方法</option>
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>

                    <div class="cards-grid" id="interfaces-grid">
                        <!-- 接口卡片动态生成 -->
                    </div>
                </div>

                <!-- 接口编辑/创建视图 -->
                <div id="interface-form-view" style="display: none;">
                    <div class="page-header">
                        <div>
                            <h1><i class="fas fa-plug"></i> <span id="interface-form-title">创建接口</span></h1>
                            <p id="interface-form-subtitle">配置接口信息和参数</p>
                        </div>
                        <button class="btn btn-secondary" id="interface-form-back">
                            <i class="fas fa-arrow-left"></i> 返回列表
                        </button>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label class="required">接口名称</label>
                            <input type="text" id="interface-name" placeholder="例如: GetUser">
                        </div>
                        <div class="form-group">
                            <label>接口描述</label>
                            <textarea id="interface-description" rows="2" placeholder="描述接口的功能"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="required">HTTP 方法</label>
                                <select id="interface-method">
                                    <option value="GET">GET</option>
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                    <option value="DELETE">DELETE</option>
                                    <option value="PATCH">PATCH</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="required">协议</label>
                                <select id="interface-protocol">
                                    <option value="http">HTTP</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="required">URL</label>
                            <input type="text" id="interface-url" placeholder="https://api.example.com/users">
                        </div>
                        <div class="form-group">
                            <label>认证类型</label>
                            <select id="interface-auth">
                                <option value="none">无认证</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>参数定义</label>
                            <div class="params-tabs">
                                <div class="params-tab-header">
                                    <button type="button" class="params-tab-btn active" data-tab="input" onclick="switchParamsTab('input')">
                                        <i class="fas fa-sign-in-alt"></i> Input 参数
                                    </button>
                                    <button type="button" class="params-tab-btn" data-tab="output" onclick="switchParamsTab('output')">
                                        <i class="fas fa-sign-out-alt"></i> Output 参数
                                    </button>
                                    <button type="button" class="params-tab-btn" data-tab="fixed" onclick="switchParamsTab('fixed')">
                                        <i class="fas fa-lock"></i> Fixed 参数
                                    </button>
                                </div>
                                <div class="params-tab-content">
                                    <div class="params-tab-description">
                                        <p id="input-tab-desc" class="tab-desc active">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>Input 参数：</strong>用户在调用接口时需要提供的参数，会显示在 MCP Schema 中
                                        </p>
                                        <p id="output-tab-desc" class="tab-desc" style="display: none;">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>Output 参数：</strong>从接口响应中提取的字段（暂未实现，用于文档标记）
                                        </p>
                                        <p id="fixed-tab-desc" class="tab-desc" style="display: none;">
                                            <i class="fas fa-info-circle"></i>
                                            <strong>Fixed 参数：</strong>使用默认值的固定参数，不允许用户修改，不显示在 MCP Schema 中
                                        </p>
                                    </div>
                                    <div id="input-params-container" class="params-tab-pane active"></div>
                                    <div id="output-params-container" class="params-tab-pane" style="display: none;"></div>
                                    <div id="fixed-params-container" class="params-tab-pane" style="display: none;"></div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary mt-2" onclick="addParamRow()">
                                <i class="fas fa-plus"></i> 添加参数
                            </button>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" id="interface-form-cancel">取消</button>
                            <button class="btn btn-primary" id="interface-form-submit">保存</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 文档页面 -->
            <div class="tab-content" id="docs-tab">
                <div class="page-header">
                    <div>
                        <h1><i class="fas fa-book"></i> API 文档</h1>
                        <p>完整的 API 接口参考</p>
                    </div>
                </div>

                <div class="docs-container">
                    <div class="doc-section">
                        <h2>快速开始</h2>
                        <ol>
                            <li>创建一个应用</li>
                            <li>定义自定义类型（可选）</li>
                            <li>创建接口并配置参数</li>
                            <li>测试接口</li>
                        </ol>
                    </div>

                    <div class="doc-section">
                        <h2>API 基础信息</h2>
                        <p><strong>Base URL:</strong> <code>/api</code></p>
                        <p><strong>Content-Type:</strong> <code>application/json</code></p>
                    </div>

                    <!-- 应用管理 API -->
                    <div class="doc-section">
                        <h2><i class="fas fa-folder-open"></i> 应用管理 API</h2>
                        
                        <h3>创建应用</h3>
                        <p><span class="badge-primary">POST</span> <code>/api/applications</code></p>
                        <h4>请求体:</h4>
                        <pre><code>{
  "name": "string (必填, 最大255字符)",
  "description": "string (可选, 最大16384字符)",
  "path": "string (必填, 最大255字符)",
  "protocol": "string (必填, 可选值: sse, streamable)",
  "enabled": "boolean (可选, 默认true)"
}</code></pre>
                        <h4>响应示例:</h4>
                        <pre><code>{
  "id": 1,
  "name": "My App",
  "description": "我的应用",
  "path": "myapp",
  "protocol": "sse",
  "enabled": true,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}</code></pre>

                        <h3>获取应用列表</h3>
                        <p><span class="badge-success">GET</span> <code>/api/applications</code></p>
                        <h4>响应示例:</h4>
                        <pre><code>[
  {
    "id": 1,
    "name": "My App",
    "description": "我的应用",
    "path": "myapp",
    "protocol": "sse",
    "enabled": true,
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
]</code></pre>

                        <h3>获取单个应用</h3>
                        <p><span class="badge-success">GET</span> <code>/api/applications/:id</code></p>
                        
                        <h3>更新应用</h3>
                        <p><span class="badge-warning">PUT</span> <code>/api/applications/:id</code></p>
                        <h4>请求体 (所有字段可选):</h4>
                        <pre><code>{
  "name": "string",
  "description": "string",
  "path": "string",
  "protocol": "string",
  "enabled": "boolean"
}</code></pre>

                        <h3>删除应用</h3>
                        <p><span class="badge-danger">DELETE</span> <code>/api/applications/:id</code></p>
                        <p class="text-muted">注意: 删除应用会同时删除所有关联的接口和自定义类型</p>
                    </div>

                    <!-- 自定义类型 API -->
                    <div class="doc-section">
                        <h2><i class="fas fa-shapes"></i> 自定义类型 API</h2>
                        
                        <h3>创建自定义类型</h3>
                        <p><span class="badge-primary">POST</span> <code>/api/custom-types</code></p>
                        <h4>请求体:</h4>
                        <pre><code>{
  "app_id": "number (必填, >0)",
  "name": "string (必填, 最大255字符)",
  "description": "string (可选, 最大16384字符)",
  "fields": [
    {
      "name": "string (必填, 最大255字符)",
      "type": "string (必填, 可选值: number, string, boolean, custom)",
      "ref": "number (当type=custom时必填, 引用其他类型的ID)",
      "is_array": "boolean (可选, 默认false)",
      "required": "boolean (可选, 默认false)",
      "description": "string (可选, 最大16384字符)"
    }
  ]
}</code></pre>
                        <h4>示例:</h4>
                        <pre><code>{
  "app_id": 1,
  "name": "User",
  "description": "用户信息",
  "fields": [
    {"name": "id", "type": "number", "required": true},
    {"name": "name", "type": "string", "required": true},
    {"name": "email", "type": "string", "required": false},
    {"name": "tags", "type": "string", "is_array": true}
  ]
}</code></pre>

                        <h3>获取类型列表</h3>
                        <p><span class="badge-success">GET</span> <code>/api/custom-types?app_id={app_id}</code></p>
                        <p><strong>查询参数:</strong> <code>app_id</code> (必填)</p>

                        <h3>获取单个类型</h3>
                        <p><span class="badge-success">GET</span> <code>/api/custom-types/:id</code></p>

                        <h3>更新类型</h3>
                        <p><span class="badge-warning">PUT</span> <code>/api/custom-types/:id</code></p>
                        <h4>请求体 (所有字段可选):</h4>
                        <pre><code>{
  "name": "string",
  "description": "string",
  "fields": [...]  // 如果提供，将完全替换现有字段
}</code></pre>

                        <h3>删除类型</h3>
                        <p><span class="badge-danger">DELETE</span> <code>/api/custom-types/:id</code></p>
                        <p class="text-muted">注意: 如果类型被其他类型或接口引用，删除将失败</p>
                    </div>

                    <!-- 接口管理 API -->
                    <div class="doc-section">
                        <h2><i class="fas fa-plug"></i> 接口管理 API</h2>
                        
                        <h3>创建接口</h3>
                        <p><span class="badge-primary">POST</span> <code>/api/interfaces</code></p>
                        <h4>请求体:</h4>
                        <pre><code>{
  "app_id": "number (必填, >0)",
  "name": "string (必填, 最大255字符)",
  "description": "string (可选, 最大16384字符)",
  "protocol": "string (必填, 可选值: http)",
  "url": "string (必填, 最大1024字符)",
  "method": "string (必填, 可选值: GET, POST, PUT, DELETE, PATCH, HEAD, OPTIONS)",
  "auth_type": "string (必填, 可选值: none, capi)",
  "enabled": "boolean (可选, 默认true)",
  "post_process": "string (可选, 后置处理脚本, 最大1048576字符)",
  "parameters": [
    {
      "name": "string (必填, 最大255字符)",
      "type": "string (必填, 可选值: number, string, boolean, custom)",
      "ref": "number (当type=custom时必填)",
      "location": "string (必填, 可选值: query, header, body, path)",
      "group": "string (必填, 可选值: input, output, fixed)",
      "is_array": "boolean (可选, 默认false)",
      "required": "boolean (可选, 默认false)",
      "description": "string (可选, 最大16384字符)",
      "default_value": "string (可选)"
    }
  ]
}</code></pre>
                        <h4>示例:</h4>
                        <pre><code>{
  "app_id": 1,
  "name": "GetUser",
  "description": "获取用户信息",
  "protocol": "http",
  "url": "https://api.example.com/users",
  "method": "GET",
  "auth_type": "none",
  "enabled": true,
  "parameters": [
    {
      "name": "id",
      "type": "string",
      "location": "query",
      "group": "input",
      "required": true,
      "description": "用户ID"
    },
    {
      "name": "apiKey",
      "type": "string",
      "location": "header",
      "group": "fixed",
      "required": true,
      "default_value": "your-api-key",
      "description": "API密钥（固定参数）"
    }
  ]
}</code></pre>

                        <h3>获取接口列表</h3>
                        <p><span class="badge-success">GET</span> <code>/api/interfaces?app_id={app_id}</code></p>
                        <p><strong>查询参数:</strong> <code>app_id</code> (必填)</p>

                        <h3>获取单个接口</h3>
                        <p><span class="badge-success">GET</span> <code>/api/interfaces/:id</code></p>

                        <h3>更新接口</h3>
                        <p><span class="badge-warning">PUT</span> <code>/api/interfaces/:id</code></p>
                        <h4>请求体 (所有字段可选):</h4>
                        <pre><code>{
  "name": "string",
  "description": "string",
  "protocol": "string",
  "url": "string",
  "method": "string",
  "auth_type": "string",
  "enabled": "boolean",
  "post_process": "string",
  "parameters": [...]  // 如果提供，将完全替换现有参数
}</code></pre>

                        <h3>删除接口</h3>
                        <p><span class="badge-danger">DELETE</span> <code>/api/interfaces/:id</code></p>
                    </div>

                    <!-- 数据类型说明 -->
                    <div class="doc-section">
                        <h2>数据类型说明</h2>
                        
                        <h3>参数类型 (type)</h3>
                        <ul>
                            <li><strong>number</strong> - 数字类型</li>
                            <li><strong>string</strong> - 字符串类型</li>
                            <li><strong>boolean</strong> - 布尔类型</li>
                            <li><strong>custom</strong> - 自定义类型（需要通过 ref 字段引用已定义的类型）</li>
                        </ul>

                        <h3>参数位置 (location)</h3>
                        <ul>
                            <li><strong>query</strong> - URL 查询参数 (?key=value)</li>
                            <li><strong>header</strong> - HTTP 请求头</li>
                            <li><strong>body</strong> - 请求体（JSON）</li>
                            <li><strong>path</strong> - URL 路径参数 (/users/{id})</li>
                        </ul>

                        <h3>参数组 (group)</h3>
                        <ul>
                            <li><strong>input</strong> - 输入参数：用户在调用接口时提供，会显示在 MCP Schema 中</li>
                            <li><strong>output</strong> - 输出参数：从接口响应中提取（未来功能，暂未实现）</li>
                            <li><strong>fixed</strong> - 固定参数：使用默认值，不允许用户修改，不显示在 MCP Schema 中</li>
                        </ul>

                        <h3>HTTP 方法</h3>
                        <ul>
                            <li><strong>GET</strong> - 获取资源</li>
                            <li><strong>POST</strong> - 创建资源</li>
                            <li><strong>PUT</strong> - 更新资源（完整更新）</li>
                            <li><strong>PATCH</strong> - 更新资源（部分更新）</li>
                            <li><strong>DELETE</strong> - 删除资源</li>
                            <li><strong>HEAD</strong> - 获取资源头信息</li>
                            <li><strong>OPTIONS</strong> - 获取支持的方法</li>
                        </ul>
                    </div>

                    <!-- 错误处理 -->
                    <div class="doc-section">
                        <h2>错误处理</h2>
                        <p>所有 API 在发生错误时会返回相应的 HTTP 状态码和错误信息。</p>
                        
                        <h3>常见状态码</h3>
                        <ul>
                            <li><strong>200 OK</strong> - 请求成功</li>
                            <li><strong>204 No Content</strong> - 删除成功（无返回内容）</li>
                            <li><strong>400 Bad Request</strong> - 请求参数错误或验证失败</li>
                            <li><strong>404 Not Found</strong> - 资源不存在</li>
                            <li><strong>500 Internal Server Error</strong> - 服务器内部错误</li>
                        </ul>

                        <h3>错误响应格式</h3>
                        <pre><code>"错误描述信息"</code></pre>
                    </div>

                    <!-- 使用示例 -->
                    <div class="doc-section">
                        <h2>使用示例</h2>
                        
                        <h3>完整工作流程</h3>
                        <pre><code># 1. 创建应用
curl -X POST http://localhost:8080/api/applications \\
  -H "Content-Type: application/json" \\
  -d '{
    "name": "My API",
    "path": "myapi",
    "protocol": "sse",
    "enabled": true
  }'

# 2. 创建自定义类型
curl -X POST http://localhost:8080/api/custom-types \\
  -H "Content-Type: application/json" \\
  -d '{
    "app_id": 1,
    "name": "User",
    "fields": [
      {"name": "id", "type": "number", "required": true},
      {"name": "name", "type": "string", "required": true}
    ]
  }'

# 3. 创建接口
curl -X POST http://localhost:8080/api/interfaces \\
  -H "Content-Type: application/json" \\
  -d '{
    "app_id": 1,
    "name": "GetUser",
    "protocol": "http",
    "url": "https://api.example.com/users",
    "method": "GET",
    "auth_type": "none",
    "parameters": [
      {
        "name": "id",
        "type": "string",
        "location": "query",
        "required": true
      }
    ]
  }'</code></pre>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 通用模态框 -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">标题</h3>
                <button class="modal-close" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 动态内容 -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">取消</button>
                <button class="btn btn-primary" id="modal-confirm">确认</button>
            </div>
        </div>
    </div>

    <!-- Toast 通知 -->
    <div class="toast-container" id="toast-container"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
