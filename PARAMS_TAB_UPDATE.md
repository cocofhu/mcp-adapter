# 参数定义 Tab 功能更新

## 更新概述

在接口编辑页面的参数定义部分增加了 Tab 页面功能，将参数分为"默认参数"和"普通参数"两类。**只有默认参数且参数类型为基本类型（number、string、boolean）时，才能设置参数默认值。**

## 主要改动

### 1. 前端界面更新 (`web/static/index.html`)

- 将原有的单一参数容器改为带 Tab 的双容器结构
- 添加"默认参数"和"普通参数"两个 Tab 页签
- 每个 Tab 对应独立的参数容器：
  - `default-params-container` - 默认参数容器
  - `regular-params-container` - 普通参数容器

### 2. 样式更新 (`web/static/css/style.css`)

新增以下样式类：
- `.params-tabs` - Tab 容器样式
- `.params-tab-header` - Tab 头部样式
- `.params-tab-btn` - Tab 按钮样式（包含激活状态）
- `.params-tab-content` - Tab 内容区域样式
- `.params-tab-pane` - 单个 Tab 面板样式

### 3. JavaScript 逻辑更新 (`web/static/js/app.js`)

#### 新增变量
```javascript
let currentParamsTab = 'default'; // 跟踪当前激活的 Tab
```

#### 新增函数

**`switchParamsTab(tab)`**
- 切换参数 Tab 的显示
- 更新 Tab 按钮的激活状态
- 控制参数容器的显示/隐藏

**`collectParamFromRow(row, allowDefaultValue)`**
- 从参数行收集数据的辅助函数
- 只有在 `allowDefaultValue=true` 且参数类型为基本类型时才保存默认值
- 用于区分默认参数和普通参数

**`handleParamTypeChange(selectElement)`**
- 处理参数类型选择变化
- 动态显示/隐藏默认值输入框
- 当类型从基本类型切换到自定义类型时，自动清空默认值

#### 修改函数

**`showInterfaceForm(interfaceId)`**
- 初始化时重置 Tab 为"默认参数"
- 清空两个参数容器
- 加载参数时根据是否有默认值分配到不同 Tab
  - 有默认值 → 默认参数 Tab
  - 无默认值 → 普通参数 Tab

**`addParamRow(paramData, isDefaultParam)`**
- 新增 `isDefaultParam` 参数，指定参数添加到哪个 Tab
- 只有在默认参数 Tab 中才显示"默认值"输入框
- **只有参数类型为基本类型（number、string、boolean）时，才显示默认值输入框**
- 自定义类型参数不显示默认值输入框
- 普通参数 Tab 只显示参数描述输入框

**接口表单提交逻辑**
- 分别从两个容器收集参数
- 默认参数：调用 `collectParamFromRow(row, true)` - 仅基本类型可保存默认值
- 普通参数：调用 `collectParamFromRow(row, false)` - 不保存默认值

## 使用说明

### 创建/编辑接口时

1. **添加默认参数**：
   - 切换到"默认参数" Tab
   - 点击"添加参数"按钮
   - 填写参数信息
   - **只有当参数类型为 number、string 或 boolean 时，才会显示默认值输入框**
   - 如果选择自定义类型，默认值输入框会自动隐藏

2. **添加普通参数**：
   - 切换到"普通参数" Tab
   - 点击"添加参数"按钮
   - 填写参数信息（不显示默认值输入框）

3. **编辑已有接口**：
   - 系统自动根据参数是否有默认值分配到对应 Tab
   - 有默认值的参数 → 默认参数 Tab
   - 无默认值的参数 → 普通参数 Tab

4. **切换参数类型**：
   - 在"默认参数" Tab 中，当从基本类型切换到自定义类型时
   - 默认值输入框会自动隐藏
   - 已输入的默认值会被清空
   - 切换回基本类型时，默认值输入框重新显示

### 特性说明

- **Tab 切换**：点击 Tab 按钮即可切换，当前激活的 Tab 高亮显示
- **独立管理**：两个 Tab 的参数互相独立，可以分别添加和删除
- **自动分类**：编辑接口时，系统根据参数的默认值自动分配到对应 Tab
- **类型约束**：
  - ✅ **基本类型（number、string、boolean）**：可以设置默认值
  - ❌ **自定义类型（custom）**：不能设置默认值（输入框自动隐藏）
  - ❌ **数组类型**：虽然可以显示默认值输入框，但建议谨慎使用
- **动态切换**：参数类型改变时，默认值输入框会自动显示或隐藏

## 类型限制说明

### 为什么限制默认值只支持基本类型？

1. **数据一致性**：自定义类型是复杂对象，不适合用简单字符串表示默认值
2. **验证复杂性**：基本类型的默认值容易验证，自定义类型需要复杂的 JSON schema 验证
3. **用户体验**：避免用户输入错误格式的复杂对象默认值
4. **后端兼容**：后端在处理默认值时，基本类型更容易转换和使用

### 支持的默认值类型

| 参数类型 | 是否支持默认值 | 示例默认值 |
|---------|--------------|-----------|
| string  | ✅ 支持 | `"hello"`, `""`, `"default"` |
| number  | ✅ 支持 | `0`, `123`, `-1`, `3.14` |
| boolean | ✅ 支持 | `true`, `false` |
| custom  | ❌ 不支持 | - |

## 后端兼容性

此更新为纯前端改动，不需要修改后端代码：
- 后端 API 保持不变
- 数据模型保持不变（`InterfaceParameter.DefaultValue` 字段已存在）
- 前端限制了只有基本类型参数可以设置默认值
- 后端在处理时会自动忽略自定义类型的默认值（如果意外存在）

## 测试建议

### 基本功能测试
1. 创建新接口，分别在两个 Tab 中添加参数
2. 保存后刷新页面，验证参数是否正确分配到对应 Tab
3. 编辑接口，修改参数的默认值，保存后验证
4. 确认普通参数 Tab 中不显示默认值输入框

### 类型约束测试
1. ✅ 在"默认参数" Tab 中添加 string 类型参数，验证默认值输入框显示
2. ✅ 在"默认参数" Tab 中添加 number 类型参数，验证默认值输入框显示
3. ✅ 在"默认参数" Tab 中添加 boolean 类型参数，验证默认值输入框显示
4. ❌ 在"默认参数" Tab 中添加自定义类型参数，验证默认值输入框隐藏
5. 🔄 在"默认参数" Tab 中将参数类型从 string 切换到自定义类型，验证：
   - 默认值输入框隐藏
   - 已输入的默认值被清空
6. 🔄 将参数类型从自定义类型切换回 string，验证默认值输入框重新显示

### 数据保存测试
1. 添加基本类型参数并设置默认值，保存后验证默认值正确保存
2. 添加自定义类型参数（无默认值输入框），保存后验证不会有默认值字段
3. 将已有默认值的参数类型改为自定义类型，保存后验证默认值被清除

## 浏览器兼容性

- 支持所有现代浏览器（Chrome, Firefox, Safari, Edge）
- 使用 CSS Flexbox 布局，IE11 可能需要 polyfill
- 使用原生 JavaScript，无需额外库
